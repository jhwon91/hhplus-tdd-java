# hhplus-tdd-java
π›³οΈ Test Driven Development

# 1. λ©ν‘

---

### `point` ν¨ν‚¤μ§€μ TODO μ™€ ν…μ¤νΈμ½”λ“λ¥Ό μ‘μ„±ν•΄μ£Όμ„Έμ”.

**μ”κµ¬ μ‚¬ν•­**

- PATCH  `/point/{id}/charge` : ν¬μΈνΈλ¥Ό μ¶©μ „ν•λ‹¤.
- PATCH `/point/{id}/use` : ν¬μΈνΈλ¥Ό μ‚¬μ©ν•λ‹¤.
- GET `/point/{id}` : ν¬μΈνΈλ¥Ό μ΅°νν•λ‹¤.
- GET `/point/{id}/histories` : ν¬μΈνΈ λ‚΄μ—­μ„ μ΅°νν•λ‹¤.
- μ”κ³ κ°€ λ¶€μ΅±ν•  κ²½μ°, ν¬μΈνΈ μ‚¬μ©μ€ μ‹¤ν¨ν•μ—¬μ•Ό ν•©λ‹λ‹¤.
- λ™μ‹μ— μ—¬λ¬ κ±΄μ ν¬μΈνΈ μ¶©μ „, μ΄μ© μ”μ²­μ΄ λ“¤μ–΄μ¬ κ²½μ° μμ°¨μ μΌλ΅ μ²λ¦¬λμ–΄μ•Ό ν•©λ‹λ‹¤.

### `Default`

- `/point` ν¨ν‚¤μ§€ (λ””λ ‰ν† λ¦¬) λ‚΄μ— `PointService` κΈ°λ³Έ κΈ°λ¥ μ‘μ„±
- `/database` ν¨ν‚¤μ§€μ κµ¬ν„μ²΄λ” μμ •ν•μ§€ μ•κ³ , μ΄λ¥Ό ν™μ©ν•΄ κΈ°λ¥μ„ κµ¬ν„
- κ° κΈ°λ¥μ— λ€ν• λ‹¨μ„ ν…μ¤νΈ μ‘μ„±

> μ΄ 4κ°€μ§€ κΈ°λ³Έ κΈ°λ¥ (ν¬μΈνΈ μ΅°ν, ν¬μΈνΈ μ¶©μ „/μ‚¬μ© λ‚΄μ—­ μ΅°ν, μ¶©μ „, μ‚¬μ©) μ„ κµ¬ν„ν•©λ‹λ‹¤.
>

### `Step 1`

- ν¬μΈνΈ μ¶©μ „, μ‚¬μ©μ— λ€ν• μ •μ±… μ¶”κ°€ (μ”κ³  λ¶€μ΅±, μµλ€ μ”κ³  λ“±)
- λ™μ‹μ— μ—¬λ¬ μ”μ²­μ΄ λ“¤μ–΄μ¤λ”λΌλ„ μμ„λ€λ΅ (νΉμ€ ν•λ²μ— ν•λ‚μ μ”μ²­μ”©λ§) μ μ–΄λ  μ μλ„λ΅ λ¦¬ν©ν† λ§
- λ™μ‹μ„± μ μ–΄μ— λ€ν• ν†µν•© ν…μ¤νΈ μ‘μ„±



### `Step 2`

- λ™μ‹μ„± μ μ–΄ λ°©μ‹μ— λ€ν• λ¶„μ„ λ° λ³΄κ³ μ„ μ‘μ„± ( **README.md** )

---

# 2. μ§„ν–‰ λ°©ν–¥μ„±

## π“Β κΈ°λ³Έμ μΈ κΈ°λ¥ κµ¬ν„

- PointService ν΄λμ¤μ—μ„ **ν¬μΈνΈ μ¶©μ „**, **μ‚¬μ©**, **μ΅°ν**, **λ‚΄μ—­ μ΅°ν** κΈ°λ¥μ„ κµ¬ν„ν–μµλ‹λ‹¤.
- κ° API μ—”λ“ν¬μΈνΈλ” PointControllerμ—μ„ κµ¬ν„ν•μ—¬  ν…μ¤νΈ μ™„λ£ ν•μ€μµλ‹λ‹¤.

## π“Β μ •μ±… μ¶”κ°€

- μ”κ³  λ¶€μ΅± μ‹ ν¬μΈνΈ μ‚¬μ© μ‹¤ν¨λ¥Ό μ²λ¦¬ν•κΈ° μ„ν• λ΅μ§μ„ μ¶”κ°€ν•  μμ •μ…λ‹λ‹¤. ν„μ¬ useUserPoint λ©”μ„λ“μ—μ„ μ”κ³  ν™•μΈ ν›„ μμ™Έλ¥Ό λ°μƒμ‹ν‚¤λ„λ΅ μμ •ν•  κ³„νμ…λ‹λ‹¤.
- ν¬μΈνΈμ μµλ€ μ¶©μ „ ν•λ„ λ° κΈ°νƒ€ μ •μ±…μ— λ€ν• μ¶”κ°€μ μΈ κµ¬ν„λ„ κ³ λ ¤ μ¤‘μ…λ‹λ‹¤.

## π“Β λ™μ‹μ„± λ¬Έμ  ν•΄κ²°

- λ™μ‹μ— μ—¬λ¬ κ±΄μ μ”μ²­μ΄ λ“¤μ–΄μ¬ λ• μμ°¨μ μΌλ΅ μ²λ¦¬λ  μ μλ„λ΅ ν•κΈ° μ„ν• μ‘μ—…μ΄ ν•„μ”ν•©λ‹λ‹¤.
- ~~μ΄ λ¶€λ¶„μ— λ€ν•΄ νΈλμ­μ… κ΄€λ¦¬μ™€ synchronized ν‚¤μ›λ“λ¥Ό μ‚¬μ©ν•  κ³„νμ…λ‹λ‹¤.~~
- synchronized ν‚¤μ›λ“λ” ν•λ²μ— ν• ν•¨μλ§ μ‹¤ν–‰ λλ‹¤.<br>
  "κ³µμ μμ›"μ— μ ‘κ·Όν•κ³  μμ§€ μ•λ‹¤ -> **"κ°™μ€ μ μ €λ³„" μ”μ²­λΌλ¦¬λ§ "λ™μ‹μ— μν–‰λμ§€ μ•κ² ν•΄μ•Ό ν•λ‹¤"**
- ConcurrentHashMap, ReentrantLock ν‚¤μ›λ“ ν™•μΈ
- μ¶”κ°€μ μΈ λ™μ‹μ„± μ μ–΄ ν…μ¤νΈλ¥Ό ν†µν•΄ μ„±λ¥ λ° λ¬΄κ²°μ„±μ„ ν™•μΈν•  μμ •μ…λ‹λ‹¤.
### π“ λ™μ‹μ„±κ³Ό μμ°¨μ„±μ„ ν…μ¤νΈν•κΈ° μ„ν• μ‹λ‚λ¦¬μ¤
#### β… λ™μ‹μ— μ—¬λ¬ μ”μ²­μ„ λ³΄λƒμ„ λ• λ°μ΄ν„° μΌκ΄€μ„± ν™•μΈ
~~~
λ©ν‘
    λ™μ‹μ— μ—¬λ¬ μ‚¬μ©μκ°€ ν¬μΈνΈ μ¶©μ „/μ‚¬μ© μ”μ²­μ„ λ³΄λƒμ„ λ•, λ°μ΄ν„° μ¶©λ μ—†μ΄ μ •ν™•ν•κ² μ²λ¦¬λλ”μ§€ ν™•μΈν•©λ‹λ‹¤.
μ‹λ‚λ¦¬μ¤
    1. 10λ…μ μ‚¬μ©μκ°€ λ™μ‹μ— ν¬μΈνΈ μ¶©μ „ μ”μ²­.
    2. κ° μ”μ²­μ΄ μ„±κ³µμ μΌλ΅ μ²λ¦¬λμ—λ”μ§€ ν™•μΈν•©λ‹λ‹¤.
    3. λ¨λ“  μ”μ²­μ΄ λλ‚ ν›„, κ° μ‚¬μ©μμ ν¬μΈνΈ μ”μ•΅μ΄ μ •μƒμ μΌλ΅ μ—…λ°μ΄νΈλμ—λ”μ§€ ν™•μΈν•©λ‹λ‹¤.
    4. ν¬μΈνΈκ°€ λ„λ½λκ±°λ‚ μ¤‘λ³µ μ²λ¦¬λμ§€ μ•μ•λ”μ§€ κ²€μ¦ν•©λ‹λ‹¤.
μμƒ κ²°κ³Ό
    λ¨λ“  μ‚¬μ©μμ ν¬μΈνΈ μ”μ•΅μ΄ μ •ν™•ν•κ² μ—…λ°μ΄νΈλμ–΄μ•Ό ν•λ©°, 
    λ™μΌν• ν¬μΈνΈκ°€ μ¤‘λ³µμΌλ΅ μ‚¬μ©λκ±°λ‚ λ„λ½λμ§€ μ•μ•„μ•Ό ν•©λ‹λ‹¤.
~~~
#### β… λ™μΌν• μ‚¬μ©μμ— λ€ν• λ™μ‹ μ”μ²­ μ²λ¦¬
~~~
λ©ν‘
    κ°™μ€ μ‚¬μ©μμ— λ€ν• λ™μ‹ μ”μ²­μ΄ μμ°¨μ μΌλ΅ μ²λ¦¬λμ–΄, λ™μ‹μ„± λ¬Έμ λ΅ μΈν•΄ μλ»λ λ°μ΄ν„°κ°€ μ €μ¥λμ§€ μ•λ”μ§€ ν™•μΈν•©λ‹λ‹¤.
μ‹λ‚λ¦¬μ¤
    1. λ™μΌν• μ‚¬μ©μμ— λ€ν•΄ λ™μ‹μ— 5κ°μ ν¬μΈνΈ μ¶©μ „ μ”μ²­.
    2. μ¶©μ „ μ”μ²­μ΄ μμ°¨μ μΌλ΅ μ²λ¦¬λμ–΄μ•Ό ν•©λ‹λ‹¤. μ²« λ²μ§Έ μ¶©μ „μ΄ μ™„λ£λ ν›„ λ‘ λ²μ§Έ μ¶©μ „μ΄ μ§„ν–‰λμ–΄μ•Ό ν•©λ‹λ‹¤.
    3. λ¨λ“  μ”μ²­μ΄ λλ‚ ν›„, ν•΄λ‹Ή μ‚¬μ©μμ μµμΆ… ν¬μΈνΈ μ”μ•΅μ„ ν™•μΈν•©λ‹λ‹¤.
    4. ν¬μΈνΈκ°€ μ¤‘λ³µ μ¶©μ „λκ±°λ‚ μλ»λ κΈμ•΅μΌλ΅ μ²λ¦¬λμ§€ μ•μ•λ”μ§€ κ²€μ¦ν•©λ‹λ‹¤.

μμƒ κ²°κ³Ό
    λ™μ‹ μ”μ²­μ—λ„ λ¶κµ¬ν•κ³  ν¬μΈνΈ μ¶©μ „μ€ μμ°¨μ μΌλ΅ μ²λ¦¬λλ©°, μµμΆ… ν¬μΈνΈ μ”μ•΅μ΄ μ •ν™•ν κ³„μ‚°λμ–΄μ•Ό ν•©λ‹λ‹¤.
    μ”μ²­μ΄ μ¶©λν•μ§€ μ•λ„λ΅ λ½(lock) λλ” μμ°¨μ  μ²λ¦¬κ°€ λ³΄μ¥λμ–΄μ•Ό ν•©λ‹λ‹¤.
~~~

#### β… ν¬μΈνΈ μ‚¬μ© μ‹ μ”μ•΅ λ¶€μ΅± λ¬Έμ  ν™•μΈ
~~~
λ©ν‘
    λ™μ‹μ„± λ¬Έμ λ΅ μΈν•΄ μ‚¬μ©μκ°€ μ”μ•΅λ³΄λ‹¤ λ§μ€ ν¬μΈνΈλ¥Ό λ™μ‹μ— μ‚¬μ©ν•λ ¤κ³  μ‹λ„ν•  λ•, μ •ν™•ν•κ² μ”μ•΅ λ¶€μ΅± μ¤λ¥κ°€ λ°μƒν•λ”μ§€ ν™•μΈν•©λ‹λ‹¤.
μ‹λ‚λ¦¬μ¤
    1. ν• μ‚¬μ©μκ°€ μ¶©λ¶„ν• ν¬μΈνΈ μ”μ•΅μ„ κ°€μ§€κ³  μμ„ λ•, λ™μ‹μ— 2κ°μ ν¬μΈνΈ μ‚¬μ© μ”μ²­.
       ex) μ”μ•΅μ΄ 500 ν¬μΈνΈμΌ λ• 2κ°μ 300 ν¬μΈνΈ μ‚¬μ© μ”μ²­μ„ λ™μ‹μ— λ³΄λƒ…λ‹λ‹¤.
    2. λ‘ μ”μ²­ μ¤‘ ν•λ‚λ§ μ„±κ³µν•΄μ•Ό ν•λ©°, λ‹¤λ¥Έ ν•λ‚λ” μ”μ•΅ λ¶€μ΅±μΌλ΅ μΈν•΄ μ‹¤ν¨ν•΄μ•Ό ν•©λ‹λ‹¤.
    3. μ”μ²­μ΄ μ²λ¦¬λ ν›„ μµμΆ… μ”μ•΅μ΄ μ •ν™•ν κ³„μ‚°λμ—λ”μ§€ ν™•μΈν•©λ‹λ‹¤.
μμƒ κ²°κ³Ό
    β€Ά μ²« λ²μ§Έ μ”μ²­μ΄ μ„±κ³µμ μΌλ΅ μ²λ¦¬λκ³ , λ‘ λ²μ§Έ μ”μ²­μ€ μ”μ•΅ λ¶€μ΅±μΌλ΅ μΈν•΄ μ‹¤ν¨ν•΄μ•Ό ν•©λ‹λ‹¤.
    β€Ά μµμΆ… ν¬μΈνΈ μ”μ•΅μ€ 200 ν¬μΈνΈ(500 - 300)κ°€ λμ–΄μ•Ό ν•©λ‹λ‹¤.
~~~
#### β… ν¬μΈνΈ μ¶©μ „/μ‚¬μ© μ”μ²­ κ°„μ μμ°¨ μ²λ¦¬ ν™•μΈ
~~~
λ©ν‘
    ν¬μΈνΈ μ¶©μ „κ³Ό μ‚¬μ© μ”μ²­μ΄ λ™μ‹μ— λ“¤μ–΄μ¬ λ•, μμ„κ°€ λ³΄μ¥λμ–΄ μ •ν™•ν•κ² μ²λ¦¬λλ”μ§€ ν™•μΈν•©λ‹λ‹¤.
μ‹λ‚λ¦¬μ¤
    1. ν• μ‚¬μ©μκ°€ λ™μ‹μ— ν¬μΈνΈ μ¶©μ „κ³Ό ν¬μΈνΈ μ‚¬μ© μ”μ²­μ„ λ³΄λƒ…λ‹λ‹¤.
       ex) μ”μ•΅μ΄ 200 ν¬μΈνΈμΌ λ• 300 ν¬μΈνΈ μ¶©μ „ μ”μ²­κ³Ό 250 ν¬μΈνΈ μ‚¬μ© μ”μ²­μ„ λ™μ‹μ— λ³΄λƒ…λ‹λ‹¤.
    2. μ‹μ¤ν…μ΄ μ”μ²­μ„ μμ°¨μ μΌλ΅ μ²λ¦¬ν•΄μ•Ό ν•©λ‹λ‹¤. λ¨Όμ € μ¶©μ „μ΄ μ™„λ£λ ν›„, μ‚¬μ© μ”μ²­μ΄ μ²λ¦¬λμ–΄μ•Ό ν•©λ‹λ‹¤.
    3. μµμΆ… ν¬μΈνΈ μ”μ•΅μ„ ν™•μΈν•μ—¬, λ‘ μ”μ²­μ΄ μμ„λ€λ΅ μ²λ¦¬λμ—λ”μ§€ κ²€μ¦ν•©λ‹λ‹¤.
μμƒ κ²°κ³Ό
    β€Ά μ¶©μ „ μ”μ²­μ΄ λ¨Όμ € μ²λ¦¬λμ–΄ μ”μ•΅μ΄ 500 ν¬μΈνΈλ΅ μ¦κ°€ν• ν›„, μ‚¬μ© μ”μ²­μ΄ μ²λ¦¬λμ–΄ μ”μ•΅μ΄ 250 ν¬μΈνΈλ΅ λ‚¨μ•„μ•Ό ν•©λ‹λ‹¤.
    β€Ά μ”μ²­ μ²λ¦¬ μμ„κ°€ μ¬λ°”λ¥΄κ² λ³΄μ¥λμ—λ”μ§€ ν™•μΈν•©λ‹λ‹¤.
~~~

#### β… λ‹¤μμ μ‚¬μ©μκ°€ λ™μ‹μ— ν¬μΈνΈλ¥Ό μ‚¬μ©ν•  λ• μ²λ¦¬ μ„±λ¥ ν™•μΈ
~~~
λ©ν‘:
    β€Ά λ‹¤μμ μ‚¬μ©μκ°€ λ™μ‹μ— ν¬μΈνΈλ¥Ό μ‚¬μ©ν•κ±°λ‚ μ¶©μ „ν•  λ• μ‹μ¤ν…μ μ„±λ¥μ΄ μ μ§€λλ”μ§€ ν™•μΈν•©λ‹λ‹¤.
μ‹λ‚λ¦¬μ¤:
    1. 10λ…μ μ‚¬μ©μκ°€ λ™μ‹μ— ν¬μΈνΈλ¥Ό μ‚¬μ©ν•κ±°λ‚ μ¶©μ „ν•λ” μ”μ²­μ„ λ³΄λƒ…λ‹λ‹¤.
    2. κ° μ‚¬μ©μμ μ”μ²­μ΄ λ™μ‹μ— μ²λ¦¬λλ”λΌλ„ μ„±λ¥ μ €ν•λ‚ λ°μ΄ν„° μΌκ΄€μ„± λ¬Έμ κ°€ λ°μƒν•μ§€ μ•λ”μ§€ ν™•μΈν•©λ‹λ‹¤.
    3. μµμΆ…μ μΌλ΅ κ° μ‚¬μ©μμ ν¬μΈνΈ μ”μ•΅μ„ ν™•μΈν•©λ‹λ‹¤.
μμƒ κ²°κ³Ό:
    β€Ά μ‹μ¤ν…μ΄ λ§μ€ μ”μ²­μ„ λ™μ‹μ— μ²λ¦¬ν•΄λ„ μ„±λ¥ μ €ν• μ—†μ΄ λ¨λ“  μ”μ²­μ΄ μ •ν™•ν•κ² μ²λ¦¬λμ–΄μ•Ό ν•©λ‹λ‹¤.
    β€Ά μµμΆ… μ”μ•΅μ΄ μ •ν™•ν κ³„μ‚°λκ³ , μ”μ²­ μ²λ¦¬ μ‹κ°„μ΄ λ„λ¬΄ μ¤λ κ±Έλ¦¬μ§€ μ•μ•„μ•Ό ν•©λ‹λ‹¤.
~~~

# 3. μ§„μ²™λ„

## β…Β **μ™„λ£λ μ‘μ—…**:

### PointService κµ¬ν„

- **ν¬μΈνΈ μ¶©μ „ κΈ°λ¥** (chargeUserPoint) μ™„λ£
- **ν¬μΈνΈ μ‚¬μ© κΈ°λ¥** (useUserPoint) μ™„λ£ (μ”κ³  λ¶€μ΅± μ²λ¦¬ ν•„μ”)
- **ν¬μΈνΈ μ΅°ν κΈ°λ¥** (getUserPoint) μ™„λ£
- **ν¬μΈνΈ λ‚΄μ—­ μ΅°ν κΈ°λ¥** (getUserPointHistory) μ™„λ£
- **μ”κ³  λ¶€μ΅± μ‹ ν¬μΈνΈ μ‚¬μ© μ‹¤ν¨ μ²λ¦¬**κ°€ μ•„μ§ λ°μ μ™„λ£

### PointController κµ¬ν„

- κ°κ°μ API μ—”λ“ν¬μΈνΈ κµ¬ν„ μ™„λ£
- λ΅κ·Έ κΈ°λ΅μ„ ν†µν•΄ μ”μ²­λ§λ‹¤ μ‚¬μ©μ ID λ° κΈμ•΅ μ •λ³΄ μ¶λ ¥

## πΒ **μ§„ν–‰ μ¤‘μΈ μ‘μ—…**

- **λ™μ‹μ„± μ μ–΄**λ¥Ό μ„ν• λ¦¬ν©ν† λ§ ν•„μ” (μμ°¨μ  μ²λ¦¬ λ° ν…μ¤νΈ)

## βΒ **λ‚¨μ€ μ‘μ—…**

- **λ™μ‹μ„± λ¬Έμ  ν•΄κ²°**: μ—¬λ¬ μ”μ²­μ΄ λ™μ‹μ— λ“¤μ–΄μ¬ λ• μμ°¨μ μΌλ΅ μ²λ¦¬λ  μ μλ„λ΅ μ„¤κ³„ μμ •
- **λ™μ‹μ„± μ μ–΄μ— λ€ν• ν†µν•© ν…μ¤νΈ** μ‘μ„±
- **README μ‘μ„±**: λ™μ‹μ„± μ μ–΄ λ°©μ‹ λ° μ‚¬μ©λ κΈ°μ μ— λ€ν• μ„¤λ…